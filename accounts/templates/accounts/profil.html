{% extends "base.html" %}
{% load static %}
{% block title %}Mon Profil{% endblock %}

{% block content %}
<section class="pt-5 pb-5">
  <div class="container">

    <div class="section-title text-center">
      <h2>Mon Profil</h2>
      <p>Informations personnelles</p>
    </div>

    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="text-center mb-4">
          {% if user.role == "prestataire" and user.prestataire.photo %}
            <img src="{{ user.prestataire.photo.url }}" alt="Photo de profil" class="img-thumbnail rounded-circle" style="width: 140px; height: 140px; object-fit: cover;">
          {% elif user.photo %}
            <img src="{{ user.photo.url }}" alt="Photo de profil" class="img-thumbnail rounded-circle" style="width: 140px; height: 140px; object-fit: cover;">
          {% else %}
            <img src="{% static 'img/default-avatar.png' %}" alt="Photo de profil" class="img-thumbnail rounded-circle" style="width: 140px; height: 140px; object-fit: cover;">
          {% endif %}
        </div>

        <div class="text-center">
          <h4>{{ user.name }}</h4>
          <p><strong>Email :</strong> {{ user.email }}</p>
          <p><strong>Profil :</strong> {{ user.get_role_display }}</p>
        </div>

        <div class="mt-4">
          <h5>üì± Contacts</h5>
          <a href="{% url 'ajouter_contact' %}" class="btn btn-outline-success btn-sm mb-2">+ Ajouter un contact</a>
          {% if user.contacts.exists %}
            <ul class="list-group">
              {% for contact in user.contacts.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <span><strong>{{ contact.type_contact.nom }} :</strong> {{ contact.valeur }}</span>
                  <span>
                    <a href="{% url 'modifier_contact' contact.id %}" class="btn btn-sm btn-link">Modifier</a>
                    <a href="{% url 'supprimer_contact' contact.id %}" class="btn btn-sm btn-link text-danger">Supprimer</a>
                  </span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted">Aucun contact enregistr√©.</p>
          {% endif %}
        </div>

        <div class="text-center mt-4 d-flex flex-wrap justify-content-center gap-2">
          <a href="{% url 'modifier_profil' %}" class="btn btn-primary">Modifier mon profil</a>
          <a href="{% url 'supprimer_profil' %}" class="btn btn-danger" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer votre profil ? Cette action est irr√©versible.');">Supprimer mon profil</a>

          {% if user.role == 'prestataire' and user.prestataire %}
            <a href="{% url 'boite_reception_prestataire' %}" class="btn btn-outline-primary">
              <i class="bi bi-inbox"></i> Voir mes messages
            </a>
            <a href="{% url 'messages_admin_prestataire' user.prestataire.id %}" class="btn btn-outline-secondary">
              <i class="bi bi-chat-dots"></i> Contacter l‚Äôadministrateur
            </a>
          {% endif %}
        </div>

        {% if user.role == 'client' %}
          <div class="mt-5">
            <h4>üìÖ Mes R√©servations</h4>
            {% if reservations %}
              <ul class="list-group">
                {% for r in reservations %}
                  <li class="list-group-item">
                    {{ r.service_offert.service.nom }} avec {{ r.service_offert.prestataire.utilisateur.name }}<br>
                    Le {{ r.date }} √† {{ r.heure }} ‚Äî <strong>{{ r.statut }}</strong>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted">Aucune r√©servation pour le moment.</p>
            {% endif %}
          </div>

        {% elif user.role == 'prestataire' and prestataire %}
          <div class="mt-5">
            <h4>üõ†Ô∏è Mes Services Offerts</h4>
            {% if offres %}
              <ul class="list-group">
                {% for o in offres %}
                  <li class="list-group-item">
                    {{ o.service.nom }} ‚Äî {{ o.prix }} FCFA
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted">Vous n'avez encore ajout√© aucun service.</p>
            {% endif %}
          </div>

          <div class="mt-5">
            <h4>üì• Demandes Re√ßues</h4>
            {% if demandes %}
              <ul class="list-group">
                {% for d in demandes %}
                  <li class="list-group-item">
                    {{ d.client.name }} a r√©serv√© {{ d.service_offert.service.nom }} le {{ d.date }} ‚Äî <strong>{{ d.statut }}</strong>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted">Aucune demande re√ßue pour le moment.</p>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
